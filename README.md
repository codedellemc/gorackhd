#gorackhd

### Go bindings for RackHD

## Description
gorackhd represents API bindings for Go that allow you to manage [RackHD](https://github.com/RackHD/RackHD). The intended functions are a direct implementation of what's available within the RackHD Monorail API. To manage machines with IPMI, also use [gorackhd-redfish](https://github.com/codedellemc/gorackhd-redfish) that talks to the RackHD Redfish API.

## Compatibility
gorackhd is created using [go-swagger](https://github.com/go-swagger/go-swagger) client generator.

## Installation of the client
To install the client:
```shell
$ go get github.com/codedellemc/gorackhd
```

## Regeneration of the client

The client relies on a swagger spec file that is taken from RackHD's [on-http](https://github.com/RackHD/on-http) library and packaged at `/swagger-spec/monorail.yml`. As the swagger spec changes, this client will update as needed.

The client also will generate multiple mocking interfaces that can be used in client applications.

The client is found within the `/client` folder which is generated by go-swagger with data models generated to the `models` folder To generate the client:
```shell
$ cd $GOPATH/src/github.com/codedellemc/gorackhd
$ make generate
```

# Testing

Tests can be executed by locally with make. They depend upon a RackHD 2.x instance running with an `Administrator` role user created.

To execute tests use the make command:

```shell
$ make test
```

Or test an individual package within the project:

```shell
$ go test ./monorail/...
```

## Environment Variables
| Name                | Description                                                      |
| ------------------- |:----------------------------------------------------------------:|
| `GORACKHD_ENDPOINT` | the API endpoint. `localhost:9090` is used by default if not set |
| `GORACKHD_USERNAME` | the RackHD user `admin` is used by default if not set            |
| `GORACKHD_PASSWORD` | the RackHD password `admin123` is used by default if not set     |


## Using the client

This sample script will retrieve (GET) all nodes. Take a look at `monorail_test.go` for more examples.

First, create a client and log into RackHD.

```go
client = monorail.New(rackhdEndpoint)
auth, err := client.Login("admin", "admin123")
if err != nil {
  ...
}
```

### Use the client to create (POST) a new node

```go
postParams := nodes.NewNodesPostParams().
    .WithIdentifiers(
        &models.Node20PartialNode{
            AutoDiscover: "false",
            Identifiers:  []string{"08:00:27:A4:52:95"},
            Name:         "vbox1",
            Type:         "compute",
            Obms:         []*models.NodesPostObmByID{},
            Relations:    []*models.RelationsObj{},
            Tags:         []string{},
        }
    )
    nodesCreated, err := client.Nodes().NodesPost(postParams, auth)
    if err != nil {
        ...
    }
```

### Use the client to fetch (GET) a list of nodes:

```go
getAllResp, err := client.Nodes().NodesGetAll(nil, auth)
if err != nil {
    ...
}
for _, node := range getAllResp.Payload {
    ...
}
```

### Use the client to tag (POST) a tag to a node:

## Contribution
Create a fork of the project into your own repository.

Run the tests provided in `monorail_test.go` to verify GET/POST/DELETE still function:
```shell
env DEBUG=1 go test -run TestNodePostOperation -v
env DEBUG=1 go test -run TestNodeGetOperation -v
env DEBUG=1 go test -run TestNodeDeleteOperation -v
```

If tests do not pass, please create an issue so it can be addressed or fix and create a PR.

If all tests pass, make changes and create a pull request with a description on what was added or removed and details explaining the changes in lines of code. If approved, project owners will merge it.

## Licensing
gorackhd is freely distributed under the [MIT License](http://codedellemc.github.io/sampledocs/LICENSE "LICENSE"). See LICENSE for details.

##Support
Please file bugs and issues on the Github issues page for this project. This is to help keep track and document everything related to this repo. For general discussions and further support you can join the [{code} by Dell EMC Community slack team](http://community.codedellemc.com/) and join the **#rackhd** channel. The code and documentation are released with no warranties or SLAs and are intended to be supported through a community driven process.
